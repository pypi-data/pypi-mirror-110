(self.webpackChunkjupyterlab_requirements=self.webpackChunkjupyterlab_requirements||[]).push([[218],{218:(e,t,n)=>{"use strict";n.r(t),n.d(t,{commandIDs:()=>Q,default:()=>Z});var s=n(271),a=n.n(s),o=n(520),i=n(486),r=n.n(i);class l{constructor(e="pypi",t="https://pypi.org/simple",n=!0,s,a){this.name=e,this.url=t,this.verify_ssl=n,this.warehouse=s,this.warehouse_api_url=a}}var c=n(629),d=n(683),u=n(797);const h="jupyterlab_requirements",m=function(e="",t={}){const n=d.ServerConnection.makeSettings(),s=c.URLExt.join(n.baseUrl,h,e);let a,o=!1;const i=new u.PromiseDelegate;return d.ServerConnection.makeRequest(s,t,n).then((n=>{if(console.log(n.status,e),n.ok)if(202===n.status){const e=n.headers.get("Location")||s;setTimeout((e=>{o&&console.debug(`Request cancelled ${e}.`),a=m(e,{}),a.promise.then((e=>i.resolve(e))).catch((e=>i.reject(e)))}),1e3,e,{method:s})}else i.resolve(n.json());else n.json().then((e=>i.reject(new d.ServerConnection.ResponseError(n,e.error)))).catch((e=>{console.error("Fail to read JSON response for request",t,JSON.parse(JSON.stringify(e)))}))})).catch((e=>{i.reject(new d.ServerConnection.NetworkError(e))})),{promise:i.promise,cancel:()=>{o=!0,a&&a.cancel(),i.reject("cancelled")}}};async function p(e="",t={}){const n=d.ServerConnection.makeSettings(),s=c.URLExt.join(n.baseUrl,h,e);let a;try{a=await d.ServerConnection.makeRequest(s,t,n)}catch(e){throw new d.ServerConnection.NetworkError(e)}const o=await a.json();if(!a.ok)throw new d.ServerConnection.ResponseError(a,o.message);return o}function g(e,...t){const n="string"==typeof e?[e]:e.raw;let s="";for(let e=0;e<n.length;e++)s+=n[e].replace(/\\/g,"\\\\").replace(/(?:\\r\\n|\\r|\\n)([ \t]*)/g,"\\\\n$1"),e<t.length&&(s+=t[e]);return s}async function _(e){return new Promise((async(t,n)=>{try{const n=await async function(e,t={}){const n={kernel_name:e};try{const e=await p("thoth/config",{body:JSON.stringify(n),method:"POST"});return JSON.parse(JSON.stringify(e))}catch(e){console.error("Error on POST /jupyterlab_requirements/thoth/config:",e)}}(e);console.debug("Config file",n),t(n)}catch(e){n(e)}}))}async function k(e,t,n,s,a){return new Promise((async(o,i)=>{"pipenv"==a&&o({thoth_config:e,thoth_config_type:"unused"});try{var l=e,c=await _(t),d=!1;if(1==r().isUndefined(c)&&(c=n,console.warn("Thoth config is undefined, using default config file",n),d=!0),null==l){console.debug("No initial thoth config found in notebook metadata.");var u=c;console.debug("No runtime environment loaded from notebook metadata. Using the one detected from source... ");var h="detected"}else{var m=l.runtime_environments[0],p=m.operating_system.name,g=m.operating_system.version,k=m.python_version,v=c.runtime_environments[0],w=v.operating_system.name,b=v.operating_system.version,y=v.python_version;console.debug("runtime environment used",m),console.debug("runtime environment detected",v);const e=[];r().isEqual(p,w)?(console.debug("Operating system name loaded is the same as detected one"),e.push(1)):(console.debug(`Operating system name loaded '${p}' is not the same as detected one '${w}'`),e.push(0)),r().isEqual(g,b)?(console.debug("Operating system version loaded is the same as detected one"),e.push(1)):(console.debug(`Operating system version loaded '${g}' is not the same as detected one '${b}'`),e.push(0)),r().isEqual(k,y)?(console.debug("Python version loaded is the same as detected one"),e.push(1)):(console.debug(`Python version loaded '${k}' is not the same as detected one '${y}'`),e.push(0)),3!=r().sum(e)?(console.debug("Runtime environment loaded is not the same as detected one"),u=c,h=0==d?"detected":"default"):(console.debug("Runtime environment loaded is the same as detected one"),u=l,h="loaded")}o({thoth_config:await async function(e,t,n){const s=e.runtime_environments,a=e.runtime_environments[0];return r().set(a,"name",t),r().set(a,"recommendation_type",n),r().set(s,0,a),r().set(e,"runtime_environments",s),console.debug("processed thoth config",e),e}(u,t,s),thoth_config_type:h})}catch(e){i(e)}}))}async function v(e,t,n,s,a,o){var i=e.kernel_name;"python3"==e.kernel_name&&(console.warn("kernel_name python3 cannot be used, assigning default one"),i="jupyterlab-requirements");const l=await k(n,i,e.thoth_config,e.recommendation_type,o),c=await async function(e,t,n,s){var a=e;console.debug("loaded requirements",a);var o=a.packages;if(console.debug("loaded requirements packages",o),0==r().size(o)){const e=await q(t);if(0==r().isEmpty(e)){var i=await async function(e,t={}){const n={notebook_content:g(e)},s="thoth/invectio";try{const e=await p(s,{body:JSON.stringify(n),method:"POST"});return JSON.parse(JSON.stringify(e))}catch(e){console.error("Error on POST /jupyterlab_requirements/"+s+":",e)}}(e);if(console.debug("gathered_libraries",i),r().size(i)>0){const e={};return r().forEach(i,(function(t){"sklearn"==t?r().set(e,"scikit-learn","*"):"dotenv"==t?r().set(e,"python-dotenv","*"):r().set(e,t,"*")})),console.debug("identified_packages",e),r().set(s,"status","only_install_from_imports"),r().set(s,"loaded_packages",e),r().set(a,"packages",e),r().set(s,"requirements",a),r().set(s,"thoth_config",n),{state:s,is_final_state:!0}}return r().set(s,"status","initial"),r().set(s,"loaded_packages",o),r().set(s,"requirements",a),r().set(s,"thoth_config",n),{state:s,is_final_state:!0}}return r().set(s,"status","initial"),r().set(s,"loaded_packages",o),r().set(s,"requirements",a),r().set(s,"thoth_config",n),{state:s,is_final_state:!0}}return r().set(s,"loaded_packages",o),r().set(s,"requirements",a),r().set(s,"thoth_config",n),{state:s,is_final_state:!1}}(s,t,r().get(l,"thoth_config"),e);return await async function(e,t,n,s,a){if(1==s)return n;const o=e;if(console.debug("initial requirements lock",o),null==o)return r().set(n,"status","only_install"),n;const i={};r().forIn(o.default,(function(e,t){r().set(i,t,e.version.replace("==",""))}));const l=E(t),c={};r().forIn(n.loaded_packages,(function(e,t){1==r().has(i,t.toLowerCase())&&r().set(c,t,e)})),console.debug("loaded packages from pipfile",n.loaded_packages),console.debug("loaded packages from pipfile lock",i),console.debug("packages in pipfile and pipfile lock",c);const d=await async function(e,t){const n=await async function(e,t={}){const n={kernel_name:e},s="kernel/packages";try{const e=await p(s,{body:JSON.stringify(n),method:"POST"});return JSON.parse(JSON.stringify(e))}catch(e){console.error("Error on POST /jupyterlab_requirements/"+s+":",e)}}(e);console.debug("packages installed (pip list)",n);const s={};return r().forIn(n,(function(e,n){r().has(t,n.toLowerCase())&&r().get(t,n.toLowerCase())==e&&r().set(s,n,e)})),console.debug("Installed packages:",s),s}(l,i);console.debug("packages from kernel and pipfile lock",d);const u={};if(r().forIn(n.loaded_packages,(function(e,t){1==r().has(d,t.toLowerCase())&&r().set(u,t,e)})),console.debug("packages from kernel and in pipfile lock and in pipfile",u),!r().isEqual(r().size(n.loaded_packages),r().size(c)))return r().set(n,"status","only_install_kernel"),r().set(n,"installed_packages",u),r().set(n,"kernel_name",l),n;if(1!=await async function(e,t){return r().forIn(t,(function(t,n){if(!r().has(e,n.toLowerCase())||r().get(e,n.toLowerCase())!=t)return!1;console.debug(`Package '${n}' in version '${t}' is already installed`)})),!0}(d,i))return r().set(n,"status","only_install_kernel"),r().set(n,"installed_packages",u),r().set(n,"kernel_name",l),n;switch(a){case"detected":return r().set(n,"status","only_install_kernel_runenv"),r().set(n,"installed_packages",n.loaded_packages),r().set(n,"kernel_name",l),n;case"loaded":return r().set(n,"status","stable"),r().set(n,"installed_packages",n.loaded_packages),r().set(n,"kernel_name",l),n;case"unused":return r().set(n,"status","stable_no_runenv"),r().set(n,"installed_packages",n.loaded_packages),r().set(n,"kernel_name",l),n}}(a,t,r().get(c,"state"),r().get(c,"is_final_state"),r().get(l,"thoth_config_type"))}async function w(e,t,n,s,a){const o=await async function(e,t,n,s=".local/share/thoth/kernels",a,o={}){const i={kernel_name:e,requirements:t,requirement_lock:n,path_to_store:s,complete_path:a},r="file/dependencies";try{return await p(r,{body:JSON.stringify(i),method:"POST"})}catch(e){console.error("Error on POST /jupyterlab_requirements/"+r+":",e)}}(e,JSON.stringify(t),JSON.stringify(n),s,a);console.debug("Store message",o)}async function b(e,t,n,s,a){await async function(e,t){const n=e.model.metadata;0==n.has("dependency_resolution_engine")||console.debug("Dependency resolution engine used for requirements already exist. Updating."),n.set("dependency_resolution_engine",t),console.debug("Dependency resolution engine used for requirements have been set successfully.")}(e,t),await x(e,n),await async function(e,t){const n=e.model.metadata;0==n.has("requirements_lock")||console.debug("Notebook requirement_lock already exist. Updating."),n.set("requirements_lock",JSON.stringify(t)),console.debug("Notebook requirements_lock have been set successfully.")}(e,s),"thoth"==t&&await async function(e,t){const n=e.model.metadata;0==n.has("thoth_config")||console.debug("Notebook Thoth config already exist. Updating."),n.set("thoth_config",JSON.stringify(t)),console.debug("Notebook Thoth config have been set successfully.")}(e,a),await e.context.save()}async function y(){return new Promise((async(e,t)=>{console.info("Python version is null, discovering it....");try{const t=await async function(e={}){const t="/kernel/python";try{const e=await p(t,{method:"GET"});return JSON.parse(JSON.stringify(e))}catch(e){console.error("Error on GET /jupyterlab_requirements/"+t+":",e)}}();console.info(`Python version discovered is '${t}'.`),e(t)}catch(e){t(null)}}))}function f(e){const t=e.content.model.metadata.get("language_info");console.debug("language_info:",t);const n=r().get(t,"version");if(console.debug("python version identified:",n),null==n)return console.debug(`Python version '${n}' is null.`),null;const s=n.match(/\d.\d/);if(console.debug("match identified:",s),null==s)throw new Error(`Python version '${n}' does not match required pattern.`);return s[0]}function E(e,t=!1){const n=e.content.model.metadata.get("kernelspec");console.debug("kernel info:",n);const s=r().get(n,"name");return console.debug("kernel_name identified:",s),"python3"==s&&0==t?(console.warn("kernel_name python3 cannot be used, assigning default one"),"jupyterlab-requirements"):s}function S(e,t){return new Promise((async(n,s)=>{try{return e.model.metadata.delete(t),n("Removed correctly "+t+" from notebook metadata")}catch(e){s(e)}}))}async function x(e,t){const n=e.model.metadata;if(0==n.has("requirements"))n.set("requirements",JSON.stringify(t)),console.debug("Notebook requirements have been set successfully.");else{if(console.debug("Notebook requirements already exist. Updating..."),1==r().isEmpty(t.packages))throw console.debug("Notebook requirements packages is empty..."),new Error(`Packages in notebook requirements is empty: '${t}' `);n.set("requirements",JSON.stringify(t))}}async function q(e){let t=e.model.cells.length;var n=r().range(0,t);let s=[];r().each(n,(function(t,n){let a=e.model.cells.get(t);if("code"===a.type&&!a.value.text.startsWith("%%")){const e=a.value.text.trim().replace("?","").replace(/^[%!]{1}[^%]{1}.*$/gm,"\n").replace(/^\s*\n/gm,"");console.debug("cell n.",t,e),s.push(e)}}));let a=s.join("\n");return a=function(e,t=4){const n=" ".repeat(t);return e.split("\n").map((e=>`${n}${e}`)).join("\n")}(a,12),console.debug("notebook content",a),a}var N=n(802);const R=new N.LabIcon({name:"thoth:add-button-icon",svgstr:'<?xml version="1.0" encoding="iso-8859-1"?>\r\n\x3c!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\r\n<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n     viewBox="0 0 52 52" style="enable-background:new 0 0 52 52;" xml:space="preserve">\r\n<g>\r\n    <path d="M26,0C11.664,0,0,11.663,0,26s11.664,26,26,26s26-11.663,26-26S40.336,0,26,0z M26,50C12.767,50,2,39.233,2,26\r\n        S12.767,2,26,2s24,10.767,24,24S39.233,50,26,50z"/>\r\n    <path d="M38.5,25H27V14c0-0.553-0.448-1-1-1s-1,0.447-1,1v11H13.5c-0.552,0-1,0.447-1,1s0.448,1,1,1H25v12c0,0.553,0.448,1,1,1\r\n        s1-0.447,1-1V27h11.5c0.552,0,1-0.447,1-1S39.052,25,38.5,25z"/>\r\n</g>\r\n</svg>\r\n'}),I=new N.LabIcon({name:"thoth:edit-button-icon",svgstr:'<?xml version="1.0" encoding="iso-8859-1"?>\r\n\x3c!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\r\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n     viewBox="0 0 330 330" style="enable-background:new 0 0 330 330;" xml:space="preserve">\r\n<g id="XMLID_23_">\r\n    <path id="XMLID_24_" d="M75,180v60c0,8.284,6.716,15,15,15h60c3.978,0,7.793-1.581,10.606-4.394l164.999-165\r\n        c5.858-5.858,5.858-15.355,0-21.213l-60-60C262.794,1.581,258.978,0,255,0s-7.794,1.581-10.606,4.394l-165,165\r\n        C76.58,172.206,75,176.022,75,180z M105,186.213L255,36.213L293.787,75l-150,150H105V186.213z"/>\r\n    <path id="XMLID_27_" d="M315,150.001c-8.284,0-15,6.716-15,15V300H30V30H165c8.284,0,15-6.716,15-15s-6.716-15-15-15H15\r\n        C6.716,0,0,6.716,0,15v300c0,8.284,6.716,15,15,15h300c8.284,0,15-6.716,15-15V165.001C330,156.716,323.284,150.001,315,150.001z"\r\n        />\r\n</g>\r\n</svg>\r\n'}),C=new N.LabIcon({name:"thoth:delete-button-icon",svgstr:'<?xml version="1.0" encoding="iso-8859-1"?>\r\n\x3c!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\r\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n     viewBox="0 0 473 473" style="enable-background:new 0 0 473 473;" xml:space="preserve">\r\n<g>\r\n    <path d="M324.285,215.015V128h20V38h-98.384V0H132.669v38H34.285v90h20v305h161.523c23.578,24.635,56.766,40,93.477,40\r\n        c71.368,0,129.43-58.062,129.43-129.43C438.715,277.276,388.612,222.474,324.285,215.015z M294.285,215.015\r\n        c-18.052,2.093-34.982,7.911-50,16.669V128h50V215.015z M162.669,30h53.232v8h-53.232V30z M64.285,68h250v30h-250V68z M84.285,128\r\n        h50v275h-50V128z M164.285,403V128h50v127.768c-21.356,23.089-34.429,53.946-34.429,87.802c0,21.411,5.231,41.622,14.475,59.43\r\n        H164.285z M309.285,443c-54.826,0-99.429-44.604-99.429-99.43s44.604-99.429,99.429-99.429s99.43,44.604,99.43,99.429\r\n        S364.111,443,309.285,443z"/>\r\n    <polygon points="342.248,289.395 309.285,322.358 276.323,289.395 255.11,310.608 288.073,343.571 255.11,376.533 276.323,397.746\r\n        309.285,364.783 342.248,397.746 363.461,376.533 330.498,343.571 363.461,310.608     "/>\r\n</g>\r\n</svg>\r\n'}),O=new N.LabIcon({name:"thoth:installed-icon",svgstr:'<?xml version="1.0" encoding="iso-8859-1"?>\r\n\x3c!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\r\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n     viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">\r\n<rect style="fill:#32BEA6;" width="512" height="512"/>\r\n<polygon style="fill:#FFFFFF;" points="203.728,392.144 104.512,305.392 125.584,281.296 200.144,346.496 383.776,126.128\r\n    408.368,146.64 "/>\r\n<g>\r\n</g>\r\n</svg>\r\n'}),P=new N.LabIcon({name:"thoth:not-installed-icon",svgstr:'<?xml version="1.0" encoding="iso-8859-1"?>\r\n\x3c!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\r\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n     viewBox="0 0 511.996 511.996" style="enable-background:new 0 0 511.996 511.996;" xml:space="preserve">\r\n<rect x="0.02" y="0.008" style="fill:#E21B1B;" width="511.956" height="511.988"/>\r\n<g>\r\n\r\n        <rect x="247.999" y="98.14" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -106.0433 256.0008)" style="fill:#FFFFFF;" width="15.999" height="315.731"/>\r\n\r\n        <rect x="98.133" y="247.993" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -106.0334 255.9967)" style="fill:#FFFFFF;" width="315.731" height="15.999"/>\r\n</g>\r\n</svg>\r\n'}),T="thoth-row-button";class J extends s.Component{constructor(e){super(e),this.state={name:"",version:"*"},this.handleChange=this.handleChange.bind(this),this.handleItemDeleted=this.handleItemDeleted.bind(this),this.handleItemEdited=this.handleItemEdited.bind(this),this.showIfInstalled=this.showIfInstalled.bind(this)}handleChange(e){"package_name"==e.target.name&&this.setState({name:e.target.value}),"package_version"==e.target.name&&this.setState({version:e.target.value})}handleItemDeleted(e){this.props.deleteSavedRow(e)}handleItemEdited(e,t){this.props.editSavedRow(e,t)}showIfInstalled(e){return"Y"==e?s.createElement(O.react,{elementPosition:"center",width:"30px",height:"30px"}):s.createElement(P.react,{elementPosition:"center",width:"30px",height:"30px"})}render(){var e=this;return s.createElement("tr",null,s.createElement("td",null,s.createElement("input",{name:"package_name",type:"text",value:this.props.name,className:"thoth-package-name-input",disabled:!0})),s.createElement("td",null,s.createElement("input",{name:"package_version",type:"text",value:this.props.version,className:"thoth-constraint-input",disabled:!0})),s.createElement("td",null,e.showIfInstalled(this.props.installed)),s.createElement("td",null,s.createElement("td",null,s.createElement("button",{title:"Add package",className:"thoth-row-button-deactivated",type:"button",disabled:!0},s.createElement(R.react,{elementPosition:"center",width:"20px",height:"20px",display:"inline-block"}))),s.createElement("td",null,s.createElement("button",{title:"Edit saved package",className:T,type:"button",onClick:e.handleItemEdited.bind(e,this.props.name,this.props.version)},s.createElement(I.react,{elementPosition:"center",width:"20px",height:"20px",display:"inline-block"}))),s.createElement("td",null,s.createElement("button",{title:"Delete saved package",className:T,type:"button",onClick:e.handleItemDeleted.bind(e,this.props.name)},s.createElement(C.react,{elementPosition:"center",width:"20px",height:"20px",display:"inline-block"})))))}}const V="thoth-row-button",j="thoth-row-button-deactivated";class D extends s.Component{constructor(e){super(e),this.state={isAdded:!1,isEditable:!1,name:"",version:"*"},this.handleItemAdded=this.handleItemAdded.bind(this),this.handleChange=this.handleChange.bind(this),this.handleItemDeleted=this.handleItemDeleted.bind(this),this.showIfInstalled=this.showIfInstalled.bind(this)}handleChange(e){"package_name"==e.target.name&&this.setState({name:e.target.value}),"package_version"==e.target.name&&this.setState({version:e.target.value})}handleItemAdded(){var e=this.state.name.toString(),t=this.state.version.toString();this.props.storeRow(e,t),this.setState({isAdded:!0,isEditable:!0})}handleItemDeleted(e){this.props.deleteRow(e)}showIfInstalled(e){return"Y"==e?s.createElement(O.react,{tag:"div",elementPosition:"center",width:"30px",height:"30px",display:"inline-block"}):s.createElement(P.react,{tag:"div",elementPosition:"center",width:"30px",height:"30px",display:"inline-block"})}handleItemEdited(e){this.props.editRow(e),this.setState({isAdded:!1,isEditable:!1})}render(){var e=this;let t,n;return t=this.state.isAdded?s.createElement("button",{title:"Include new package",className:j,type:"button",disabled:!0},s.createElement(R.react,{tag:"div",elementPosition:"center",width:"20px",height:"20px",display:"inline-block"})):s.createElement("button",{title:"Include new package",className:V,type:"button",onClick:e.handleItemAdded.bind(e)},s.createElement(R.react,{tag:"div",elementPosition:"center",width:"20px",height:"20px",display:"inline-block"})),n=this.state.isEditable?s.createElement("button",{title:"Edit package",className:V,type:"button",onClick:e.handleItemEdited.bind(e,this.state.name)},s.createElement(I.react,{tag:"div",elementPosition:"center",width:"20px",height:"20px",display:"inline-block"})):s.createElement("button",{title:"Edit package",className:j,type:"button",disabled:!0},s.createElement(I.react,{tag:"div",elementPosition:"center",width:"20px",height:"20px",display:"inline-block"})),s.createElement("tr",null,s.createElement("td",null,s.createElement("input",{name:"package_name",type:"text",value:this.state.name,className:"thoth-package-name-input",onChange:this.handleChange})),s.createElement("td",null,s.createElement("input",{name:"package_version",type:"text",value:this.state.version,className:"thoth-constraint-input",onChange:this.handleChange})),s.createElement("td",null,e.showIfInstalled(this.props.installed)),s.createElement("td",null,s.createElement("td",null,t),s.createElement("td",null,n),s.createElement("td",null,s.createElement("button",{title:"Delete new package",className:V,type:"button",onClick:e.handleItemDeleted.bind(e,this.state.name)},s.createElement(C.react,{tag:"div",elementPosition:"center",width:"20px",height:"20px",display:"inline-block"})))))}}const A="thoth-table";class z extends s.Component{constructor(e){super(e),this.state={headers:["Package","Constraint","Installed","Actions"]}}renderTableHeader(){var e=[];const t=this.state.headers;return r().forEach(t,(function(t){e.push(s.createElement("th",{className:{THOTH_TABLE:A}},t.toUpperCase()))})),e}renderRows(){var e=this,t=this.props.packages,n=this.props.loaded_packages,a=this.props.installed_packages,o=[];for(let[i,l]of Object.entries(n))r().has(a,i)?o.push(s.createElement(J,{name:i,version:l,installed:"Y",packages:t,editSavedRow:e.props.editSavedRow,deleteSavedRow:e.props.deleteSavedRow})):o.push(s.createElement(J,{name:i,version:l,installed:"N",packages:t,editSavedRow:e.props.editSavedRow,deleteSavedRow:e.props.deleteSavedRow}));for(let[n,a]of Object.entries(t))o.push(s.createElement(D,{name:n,installed:"N",packages:t,editRow:e.props.editRow,storeRow:e.props.storeRow,deleteRow:e.props.deleteRow}));return o}render(){return s.createElement("table",{id:A,className:A},s.createElement("thead",{className:{THOTH_TABLE:A}},s.createElement("tr",{id:A,className:A},this.renderTableHeader())),s.createElement("tbody",{className:{THOTH_TABLE:A}},this.renderRows()))}}class L extends s.Component{constructor(e){super(e)}render(){return s.createElement(z,{packages:this.props.packages,loaded_packages:this.props.loaded_packages,installed_packages:this.props.installed_packages,editRow:this.props.editRow,storeRow:this.props.storeRow,editSavedRow:this.props.editSavedRow,deleteRow:this.props.deleteRow,deleteSavedRow:this.props.deleteSavedRow})}}const M=new N.LabIcon({name:"thoth:save-button-icon",svgstr:'<?xml version="1.0" encoding="iso-8859-1"?>\r\n\x3c!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\r\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r\n<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n     width="356.725px" height="356.725px" viewBox="0 0 356.725 356.725" style="enable-background:new 0 0 356.725 356.725;"\r\n     xml:space="preserve">\r\n<g>\r\n    <g>\r\n        <path d="M307.463,0h-46.35H95.611H49.259C27.905,0,10.53,17.381,10.53,38.73v279.264c0,21.352,17.375,38.73,38.729,38.73H124.3\r\n            h108.125h75.037c21.357,0,38.732-17.379,38.732-38.73V38.73C346.196,17.381,328.821,0,307.463,0z M251.43,19.365v121.922H105.295\r\n            V19.365H251.43z M133.981,337.359v-93.593h88.761v93.593H133.981z M326.83,317.994c0,10.676-8.686,19.365-19.366,19.365h-65.355\r\n            V234.084c0-5.352-4.334-9.682-9.683-9.682H124.301c-5.348,0-9.684,4.33-9.684,9.682v103.275H49.26\r\n            c-10.681,0-19.366-8.689-19.366-19.365V38.73c0-10.674,8.686-19.365,19.366-19.365h36.669v131.604\r\n            c0,5.344,4.335,9.684,9.683,9.684h165.503c5.346,0,9.682-4.34,9.682-9.684V19.365h36.668c10.682,0,19.366,8.691,19.366,19.365\r\n            L326.83,317.994L326.83,317.994z"/>\r\n        <path d="M127.043,123.898h102.64c5.347,0,9.681-4.34,9.681-9.684c0-5.351-4.334-9.682-9.681-9.682h-102.64\r\n            c-5.348,0-9.684,4.331-9.684,9.682C117.359,119.558,121.695,123.898,127.043,123.898z"/>\r\n        <path d="M127.043,90.009h102.64c5.347,0,9.681-4.34,9.681-9.684c0-5.352-4.334-9.682-9.681-9.682h-102.64\r\n            c-5.348,0-9.684,4.33-9.684,9.682C117.359,85.67,121.695,90.009,127.043,90.009z"/>\r\n        <path d="M127.043,56.119h102.64c5.347,0,9.681-4.339,9.681-9.682c0-5.352-4.334-9.682-9.681-9.682h-102.64\r\n            c-5.348,0-9.684,4.33-9.684,9.682C117.359,51.78,121.695,56.119,127.043,56.119z"/>\r\n        <path d="M203.78,253.441c-5.35,0-9.684,4.34-9.684,9.682v27.439c0,5.344,4.334,9.684,9.684,9.684c5.347,0,9.683-4.34,9.683-9.684\r\n            v-27.439C213.462,257.781,209.126,253.441,203.78,253.441z"/>\r\n    </g>\r\n</g>\r\n</svg>\r\n'});class U extends s.Component{constructor(e){super(e)}saveRequirements(){this.props.onSave()}render(){return s.createElement("button",{title:"Save dependencies",className:"thoth-save-button",type:"button",onClick:this.saveRequirements.bind(this)},s.createElement(M.react,{tag:"div",elementPosition:"center",right:"7px",top:"5px",width:"20px",height:"20px"}))}}class G extends s.Component{constructor(e){super(e)}onInstall(){this.props.install()}render(){return s.createElement("button",{title:"Install dependencies",className:"thoth-install-button",onClick:this.onInstall.bind(this)},"Install")}}class H extends s.Component{constructor(e){super(e)}addNewEmptyRow(){this.props.addNewRow()}render(){return s.createElement("button",{title:"Add new line! Only one empty line is displayed.",className:"thoth-new-package-button",type:"button",onClick:this.addNewEmptyRow.bind(this)},s.createElement(R.react,{tag:"div",elementPosition:"center",width:"20px",height:"20px",display:"inline-block"}))}}var B=n(168);class F{constructor(e){this._onIOPub=e=>{switch(e.header.msg_type){case"execute_input":case"execute_result":case"display_data":console.log("DISPLAY DATA:",e.content);case"stream":console.log("STREAMING:",e.content);case"update_display_data":this._output=e.content,this._stateChanged.emit()}},this._future=null,this._output=null,this._stateChanged=new B.Signal(this),this._sessionContext=e}get future(){return this._future}set future(e){this._future=e,e&&(e.onIOPub=this._onIOPub)}get output(){return this._output}get stateChanged(){return this._stateChanged}async get_kernel_output(){return this._output}async execute(e){var t,n,s;this._sessionContext&&(null===(t=this._sessionContext.session)||void 0===t?void 0:t.kernel)&&(this.future=null===(s=null===(n=this._sessionContext.session)||void 0===n?void 0:n.kernel)||void 0===s?void 0:s.requestExecute({code:e}))}}const $="thoth-ok-button",K="thoth-container-button",W="thoth-container-button-centre";class Y extends s.Component{constructor(e){super(e),this.state={kernel_name:E(this.props.panel),recommendation_type:"latest",status:"loading",packages:{},loaded_packages:{},installed_packages:{},deleted_packages:{},requirements:{packages:{},requires:{python_version:f(this.props.panel)},sources:[{name:"pypi",url:"https://pypi.org/simple",verify_ssl:!0}]},thoth_config:{host:"khemenu.thoth-station.ninja",tls_verify:!1,requirements_format:"pipenv",runtime_environments:[{name:"ubi:8",operating_system:{name:"ubi",version:"8"},python_version:"3.8",recommendation_type:"latest"}]},error_msg:void 0,resolution_engine:"thoth",thoth_timeout:180,isEditing:!1,root_directory:""},this.onStart=this.onStart.bind(this),this.execute_code_in_kernel=this.execute_code_in_kernel.bind(this),this.changeUIstate=this.changeUIstate.bind(this),this.addNewRow=this.addNewRow.bind(this),this.editRow=this.editRow.bind(this),this.editSavedRow=this.editSavedRow.bind(this),this.storeRow=this.storeRow.bind(this),this.deleteRow=this.deleteRow.bind(this),this.deleteSavedRow=this.deleteSavedRow.bind(this),this.onSave=this.onSave.bind(this),this.lock_using_thoth=this.lock_using_thoth.bind(this),this.lock_using_pipenv=this.lock_using_pipenv.bind(this),this.install=this.install.bind(this),this.setKernel=this.setKernel.bind(this),this.setKernelName=this.setKernelName.bind(this),this.setRecommendationType=this.setRecommendationType.bind(this),this.setTimeout=this.setTimeout.bind(this),this.setRootDirectoryPath=this.setRootDirectoryPath.bind(this),this._model=new F(this.props.panel.sessionContext)}async execute_code_in_kernel(e){await this._model.execute(e)}changeUIstate(e,t,n,s,a,o,i,l,c){var d=this.state;console.debug("initial",d),r().set(d,"status",e),r().set(d,"packages",t),r().set(d,"loaded_packages",n),r().set(d,"installed_packages",s),r().set(d,"deleted_packages",a),r().set(d,"requirements",o),r().set(d,"kernel_name",i),r().set(d,"thoth_config",l),r().set(d,"error_msg",c),console.debug("new",d),this.setState(d)}setRecommendationType(e){this.setState({recommendation_type:e})}setRootDirectoryPath(e){var t=e.target.value;this.setState({root_directory:t})}async setNewState(e){console.log("new state",e),this.setState(e)}changeRecommendationType(e){const t=e.target.value;this.setRecommendationType(t)}setKernelName(e){var t=e.target.value;"python3"==e.target.value&&(console.warn("kernel_name python3 cannot be used assigning default one"),t="jupyterlab-requirements"),e.target.value.match(":")&&(console.warn("kernel_name cannot contain `:` due to configurations limits."),t=e.target.value.replace(":","-")),this.setState({kernel_name:t})}setTimeout(e){var t=Number(e.target.value);Number(e.target.value)>300&&(console.warn("kernel_name python3 cannot be used assigning default one"),t=300),this.setState({thoth_timeout:t})}addNewRow(){const e=this.state.packages;r().set(e,"",""),console.debug("added package",e),this.changeUIstate("editing",e,this.state.loaded_packages,this.state.installed_packages,this.state.deleted_packages,this.state.requirements,this.state.kernel_name,this.state.thoth_config)}editRow(e){const t=this.state.packages,n=this.state.loaded_packages,s=this.state.installed_packages;r().unset(t,e),r().unset(n,e),r().unset(s,e),r().set(t,"","*"),console.debug("After editing (current)",t),this.changeUIstate("editing",t,n,s,this.state.deleted_packages,this.state.requirements,this.state.kernel_name,this.state.thoth_config)}editSavedRow(e,t){const n=this.state.loaded_packages,s=this.state.packages,a=this.state.installed_packages;r().unset(s,e),r().unset(n,e),r().unset(a,e),r().set(s,"","*"),console.debug("After editing (initial)",n),console.debug("After editing (current)",s),this.changeUIstate("editing",s,n,a,this.state.deleted_packages,this.state.requirements,this.state.kernel_name,this.state.thoth_config)}deleteRow(e){const t=this.state.packages,n={};r().unset(t,e),console.debug("After deleting",t),r().set(n,e,"*"),console.debug("Deleted",n),this.changeUIstate("editing",t,this.state.loaded_packages,this.state.installed_packages,n,this.state.requirements,this.state.kernel_name,this.state.thoth_config)}deleteSavedRow(e){const t=this.state.loaded_packages;r().unset(t,e),console.debug("After deleting saved",t);const n={};r().set(n,e,"*"),console.debug("Deleted",n),this.changeUIstate("editing",this.state.packages,t,this.state.installed_packages,n,this.state.requirements,this.state.kernel_name,this.state.thoth_config)}storeRow(e,t){let n=this.state.packages;r().set(n,e,t);const s={};r().forIn(n,(function(e,t){console.debug(t+" goes "+e),""!=t&&r().set(s,t,e)})),console.debug("new packages",s),this.changeUIstate("editing",s,this.state.loaded_packages,this.state.installed_packages,this.state.deleted_packages,this.state.requirements,this.state.kernel_name,this.state.thoth_config)}async onSave(){var e=await async function(e,t){console.debug("loaded_packages",e),console.debug("added_packages",t);const n={};r().forIn(e,(function(t,s){0==r().has(e,"")&&r().set(n,s,t)}));const s={};return r().forIn(t,(function(e,a){0==r().has(t,"")&&(r().set(n,a,e),r().set(s,a,e))})),{new_packages:s,total_packages:n}}(this.state.loaded_packages,this.state.packages),t=await async function(e,t,n,s,a){if(r().size(e)>0){if(r().size(t)>0)return{action_required:"relock",new_state:s};await async function(e){S(e,"requirements"),S(e,"requirements_lock"),S(e,"thoth_config"),S(e,"dependency_resolution_engine"),e.context.save()}(n);var o={packages:{},requires:s.requirements.requires,sources:s.requirements.sources};return r().set(s,"status","initial"),r().set(s,"packages",a),r().set(s,"deleted_packages",{}),r().set(s,"requirements",o),{action_required:"go_to_state",new_state:s}}return{action_required:"continue",new_state:s}}(this.state.deleted_packages,r().get(e,"total_packages"),this.props.panel,this.state,r().get(e,"new_packages"));if("relock"!=r().get(t,"action_required"))if("go_to_state"!=r().get(t,"action_required")){var n=await async function(e,t,n){if(r().size(e)>0){if(r().isEqual(e,n.installed_packages))return x(t,{packages:e,requires:n.requirements.requires,sources:n.requirements.sources}),t.context.save(),r().set(n,"status","stable"),r().set(n,"packages",{}),n;console.debug("total packages",e);var s={packages:e,requires:n.requirements.requires,sources:n.requirements.sources};return console.debug("Requirements before installing are: ",s),x(t,s),t.context.save(),r().set(n,"status","saved"),r().set(n,"packages",{}),r().set(n,"loaded_packages",e),r().set(n,"requirements",s),n}return r().set(n,"status","failed_no_reqs"),r().set(n,"packages",e),n}(r().get(e,"total_packages"),this.props.panel,this.state);await this.setNewState(n)}else await this.setNewState(r().get(t,"new_state"));else await this.lock_using_thoth()}async install(){var e=this.state;try{const t=await async function(e,t){try{const s={kernel_name:e,resolution_engine:t},a={body:JSON.stringify(s),method:"POST"};var n="kernel/install";const{promise:o}=m(n,a),i=await o;if(i)return JSON.parse(JSON.stringify(i))}catch(e){let t=e.message||e.toString();"cancelled"!==t&&(console.error("Error on POST /jupyterlab_requirements/"+n+":",t),t="An error occurred while installing dependencies.")}}(this.state.kernel_name,this.state.resolution_engine);return console.debug("Install message",t),r().set(e,"status","setting_kernel"),r().set(e,"packages",{}),void await this.setNewState(e)}catch(t){return console.debug("Error installing requirements",t),r().set(e,"status","failed"),r().set(e,"error_msg","Error install dependencies in the new virtual environment, please contact Thoth team."),void await this.setNewState(e)}}async setKernel(){var e=this.state;try{const t=await async function(e,t={}){const n={kernel_name:e},s="kernel/create";try{return await p(s,{body:JSON.stringify(n),method:"POST"})}catch(e){console.error("Error on POST /jupyterlab_requirements/"+s+":",e)}}(this.state.kernel_name);return console.debug("Kernel message",t),r().set(e,"status","ready"),r().set(e,"packages",{}),r().set(e,"installed_packages",e.loaded_packages),void await this.setNewState(e)}catch(t){return console.debug("Error creating jupyter kernel",t),r().set(e,"status","failed"),r().set(e,"error_msg","Error setting new environment in a jupyter kernel, please contact Thoth team: "),void await this.setNewState(e)}}async lock_using_thoth(){var e=this.state;r().set(e,"status","locking_requirements"),await this.setNewState(e);const t=await q(this.props.panel);var n=await _(this.state.kernel_name);if("pipenv"==this.props.loaded_resolution_engine){console.debug("thoth previously failed!");const t=await k(this.props.loaded_config_file,this.state.kernel_name,e.thoth_config,e.recommendation_type,"thoth");n=r().get(t,"thoth_config")}try{var s=await async function(e,t,n,s,a){try{const i={kernel_name:e,thoth_timeout:t,notebook_content:n,thoth_config:s,requirements:a},r={body:JSON.stringify(i),method:"POST"};var o="thoth/resolution";const{promise:l}=m(o,r),c=await l;if(c)return JSON.parse(JSON.stringify(c))}catch(e){let t=e.message||e.toString();"cancelled"!==t&&(console.error("Error on POST /jupyterlab_requirements/"+o+":",t),t="An error occurred while asking advise to Thoth.")}}(this.state.kernel_name,this.state.thoth_timeout,t,JSON.stringify(n),JSON.stringify(this.state.requirements));console.debug("Advise received",s)}catch(t){return console.debug("Error locking requirements with Thoth",t),r().set(e,"status","locking_requirements_using_pipenv"),void await this.setNewState(e)}if(null==s||1==s.error)return null!=s&&console.log("Thoth resolution engine error:",s.error_msg),r().set(e,"resolution_engine","pipenv"),r().set(e,"status","locking_requirements_using_pipenv"),void await this.setNewState(e);try{await b(this.props.panel,"thoth",s.requirements,s.requirement_lock,this.state.thoth_config)}catch(e){console.debug("Error updating notebook metadata",e)}try{await w(this.state.kernel_name,s.requirements,s.requirement_lock,"overlays",this.state.root_directory)}catch(e){console.debug("Error storing dependencies in overlays",e)}try{await async function(e,t,n,s={}){const a={runtime_environment:e,force:t,complete_path:n};try{const e=await p("thoth/config",{body:JSON.stringify(a),method:"PUT"});return JSON.parse(JSON.stringify(e))}catch(e){console.error("Error on PUT /jupyterlab_requirements/thoth/config:",e)}}(this.state.thoth_config.runtime_environments[0],!0,this.state.root_directory)}catch(e){console.debug("Error updating thoth config on disk",e)}r().set(e,"status","installing_requirements"),r().set(e,"packages",{}),r().set(e,"deleted_packages",{}),r().set(e,"requirements",s.requirements),r().set(e,"resolution_engine","thoth"),await this.setNewState(e)}async lock_using_pipenv(){var e=this.state;const t=this.state.requirements;console.debug("Requirements for pipenv",JSON.stringify(t));try{var n=await async function(e,t){try{const s={kernel_name:e,requirements:t},a={body:JSON.stringify(s),method:"POST"};var n="pipenv";const{promise:o}=m(n,a),i=await o;if(i)return JSON.parse(JSON.stringify(i))}catch(e){let t=e.message||e.toString();"cancelled"!==t&&(console.error("Error on POST /jupyterlab_requirements/"+n+":",t),t="An error occurred while locking dependencies with pipenv.")}}(this.state.kernel_name,JSON.stringify(t));console.debug("Result received",n)}catch(t){return console.debug("Error locking requirements with pipenv",t),r().set(e,"status","failed"),r().set(e,"error_msg","Error asking advise to Thoth, please contact Thoth team: "),void await this.setNewState(e)}if(null==n||1==n.error)return null!=n&&console.log("Pipenv resolution engine error:",n.error_msg),r().set(e,"status","failed"),r().set(e,"error_msg","No resolution engine was able to install dependendices, please contact Thoth team: "),void await this.setNewState(e);try{await b(this.props.panel,"pipenv",t,n.requirements_lock)}catch(e){console.debug("Error storing metadata in notebook",e)}try{await w(this.state.kernel_name,t,n.requirements_lock,"overlays",this.state.root_directory)}catch(e){console.debug("Error storing dependencies in overlays",e)}r().set(e,"status","installing_requirements"),r().set(e,"packages",{}),r().set(e,"deleted_packages",{}),r().set(e,"requirements",t),r().set(e,"resolution_engine","pipenv"),await this.setNewState(e)}async onStart(){const e=await async function(e={}){const t="file/directory";try{const e=await p(t,{method:"GET"});return JSON.parse(JSON.stringify(e))}catch(e){console.error("Error on GET /jupyterlab_requirements/"+t+":",e)}}();var t=await v(this.state,this.props.panel,this.props.loaded_config_file,this.props.loaded_requirements,this.props.loaded_requirements_lock,this.props.loaded_resolution_engine);r().set(t,"root_directory",e),await this.setNewState(t)}render(){let e=s.createElement("div",null,s.createElement(L,{loaded_packages:this.state.loaded_packages,installed_packages:this.state.installed_packages,packages:this.state.packages,editRow:this.editRow,storeRow:this.storeRow,deleteRow:this.deleteRow,editSavedRow:this.editSavedRow,deleteSavedRow:this.deleteSavedRow})),t=s.createElement("div",null,s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement(H,{addNewRow:this.addNewRow}))),s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement(G,{changeUIstate:this.changeUIstate,install:this.lock_using_thoth})))),n=s.createElement("div",null,s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement(H,{addNewRow:this.addNewRow}))),s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement(U,{onSave:this.onSave,changeUIstate:this.changeUIstate})))),a=s.createElement("div",null,s.createElement("section",null,s.createElement("h2",null,"OPTIONS")),s.createElement("form",null,s.createElement("label",null,"Kernel name:",s.createElement("input",{title:"Kernel name",type:"text",name:"kernel_name",value:this.state.kernel_name,onChange:this.setKernelName})),s.createElement("br",null),s.createElement("label",null,"Path root project:",s.createElement("input",{title:"Path root project",type:"text",name:"root_directory",value:this.state.root_directory,onChange:this.setRootDirectoryPath})),s.createElement("br",null),s.createElement("label",null,"Recommendation type:",s.createElement("select",{onChange:()=>this.changeRecommendationType},'title="Recommendation Type" name="recommendation_type" value=',this.state.recommendation_type,s.createElement("option",{value:"latest"},"latest"),s.createElement("option",{value:"performance"},"performance"),s.createElement("option",{value:"security"},"security"),s.createElement("option",{value:"stable"},"stable"))),s.createElement("br",null),s.createElement("label",null,"Thoth timeout [s]:",s.createElement("input",{title:"Thoth timeout",type:"text",name:"thoth_timeout",value:this.state.thoth_timeout,onChange:this.setTimeout}))));switch(this.state.status){case"loading":return this.onStart(),s.createElement("div",null,"Loading...");case"initial":return s.createElement("div",null,s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement(H,{addNewRow:this.addNewRow}))),s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null," No dependencies found! Click New to add package. "))));case"no_reqs_to_save":return s.createElement("div",null,e,n,s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null," Dependencies missing! Click New to add package. "))));case"only_install":return s.createElement("div",null,e,t,s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"Dependencies found in notebook metadata but lock file is missing. "))),a);case"only_install_kernel":return s.createElement("div",null,e,t,s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"Pinned down software stack found in notebook metadata!",s.createElement("br",null),"The kernel selected does not match the dependencies found for the notebook. ",s.createElement("br",null),"Please install them."))),a);case"only_install_kernel_runenv":return s.createElement("div",null,e,t,s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"Pinned down software stack found in notebook metadata!",s.createElement("br",null),"The runtime environment found in the notebook does not match your environment. ",s.createElement("br",null),"Please use install button."))),a);case"only_install_from_imports":return s.createElement("div",null,e,t,s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"No dependencies found in notebook metadata!",s.createElement("br",null),"Thoth identified the packages that are required to run this notebook from your code. ",s.createElement("br",null),"(Please verify the names of the packages, in the future this won't be necessary). ",s.createElement("br",null),"Please use install button to install dependencies identified."))),a);case"editing":return s.createElement("div",null,e,n);case"saved":return s.createElement("div",null,e,t,a);case"locking_requirements":return s.createElement("div",null,e,s.createElement("fieldset",null,s.createElement("p",null,"Contacting thoth for advise... please be patient!")));case"installing_requirements":return this.install(),s.createElement("div",null,e,s.createElement("fieldset",null,s.createElement("p",null,"Requirements locked and saved!",s.createElement("br",null),"Installing new requirements...")));case"setting_kernel":return this.setKernel(),s.createElement("div",null,e,s.createElement("fieldset",null,s.createElement("p",null,"Requirements locked and saved!",s.createElement("br",null),"Requirements installed!",s.createElement("br",null),"Setting new kernel for your notebook...")));case"failed_no_reqs":return s.createElement("div",null,s.createElement("div",null,s.createElement("button",{title:"Add requirements.",className:$,onClick:()=>this.changeUIstate("loading",this.state.packages,this.state.loaded_packages,this.state.installed_packages,this.state.deleted_packages,this.state.requirements,this.state.kernel_name,this.state.thoth_config)},"Ok")),s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"No requirements have been added please click add from actions after inserting a package!"))));case"locking_requirements_using_pipenv":return this.lock_using_pipenv(),s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"Thoth resolution engine failed... pipenv will be used to lock dependencies!")));case"failed":return s.createElement("div",null,e,s.createElement("div",null,s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement("button",{title:"Finish.",className:$,onClick:()=>this.changeUIstate("loading",this.state.packages,this.state.loaded_packages,this.state.installed_packages,this.state.deleted_packages,this.state.requirements,this.state.kernel_name,this.state.thoth_config)},"Ok")))),s.createElement("div",null,s.createElement("p",null,this.state.error_msg)),s.createElement("a",{href:"https://github.com/thoth-station/jupyterlab-requirements/issues/new?assignees=&labels=bug&template=bug_report.md",target:"_blank"}," Open Issue "));case"stable":return s.createElement("div",null,e,s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement(H,{addNewRow:this.addNewRow}))),s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null," Everything installed and ready to use!"))));case"stable_no_runenv":return s.createElement("div",null,e,s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement(H,{addNewRow:this.addNewRow}))),s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"Everything installed and ready to use!",s.createElement("br",null),"Keep in mind no runtime environment is present in the notebook metadata. ",s.createElement("br",null),"Therefore your software stack might not be optimized for your environment. ",s.createElement("br",null)))));case"ready":const o=E(this.props.panel,!0);return o==this.state.kernel_name?console.log("kernel name to be assigned "+this.state.kernel_name+" already set for the notebook "+o+", do not restart kernel..."):this.props.panel.sessionContext.session.changeKernel({name:this.state.kernel_name}),s.createElement("div",null,e,s.createElement("div",null,s.createElement("div",{className:K},s.createElement("div",{className:W},s.createElement("button",{title:"Reload Page and assign kernel.",className:$,onClick:()=>this.changeUIstate("stable",this.state.packages,this.state.loaded_packages,this.state.installed_packages,this.state.deleted_packages,this.state.requirements,this.state.kernel_name,this.state.thoth_config)},"Ok")))),s.createElement("div",null,s.createElement("fieldset",null,s.createElement("p",null,"Requirements locked and saved!",s.createElement("br",null),"Requirements installed!",s.createElement("br",null),"New kernel created!",s.createElement("br",null),"Click ok to start working on your notebook.",s.createElement("br",null)))))}}}class X{constructor(){this.openWidget=async()=>{const e=await(t=this.panel,new Promise(((e,n)=>{const s=t.model.metadata;try{0==s.has("dependency_resolution_engine")&&(console.debug("dependency_resolution_engine key is not in notebook metadata!"),e(null));var a=s.get("dependency_resolution_engine").toString();console.debug("dependency_resolution_engine key is in notebook metadata!"),e(a)}catch(e){n(e)}})));var t;console.log("Resolution engine from notebook metadata",e);const n=await function(e){return new Promise((async(t,n)=>{try{if(0==e.model.metadata.has("requirements")){console.debug("requirements key is not in notebook metadata! Initialize requirements for user...");const n={};if(null==(s=f(e)))var s=await y();return t({packages:n,requires:{python_version:s},sources:[new l]})}const n=e.model.metadata.get("requirements");let a=JSON.parse(n.toString());if(0==r().size(a)){console.debug("requirements key is not in notebook metadata! Initialize requirements for user...");const n={};return null==(s=f(e))&&(s=await y()),t({packages:n,requires:{python_version:s},sources:[new l]})}return console.debug("requirements key is in notebook metadata!"),t(a)}catch(e){n(e)}}))}(this.panel);console.log("requirements",n);const s=await function(e){return new Promise((async(t,n)=>{const s=e.model.metadata;try{0==s.has("requirements_lock")&&(console.debug("requirements_lock key is not in notebook metadata!"),t(null));const e=s.get("requirements_lock");var a=JSON.parse(e.toString());console.debug("requirements_lock key is in notebook metadata!"),t(a)}catch(e){n(e)}}))}(this.panel);console.log("requirements_lock",s);const i=await function(e){return new Promise((async(t,n)=>{const s=e.model.metadata;try{0==s.has("thoth_config")&&(console.debug("thoth_config key is not in notebook metadata!"),t(null));const e=s.get("thoth_config");var a=JSON.parse(e.toString());console.debug("thoth_config key is in notebook metadata!"),t(a)}catch(e){n(e)}}))}(this.panel);console.log("Thoth config from notebook metadata",i);const c={title:"Manage Dependencies",body:o.ReactWidget.create(a().createElement(Y,{panel:this.panel,loaded_requirements:n,loaded_requirements_lock:s,loaded_config_file:i,loaded_resolution_engine:e})),buttons:[o.Dialog.cancelButton()]};new o.Dialog(c).launch()}}createNew(e,t){this.panel=e;const n=new o.ToolbarButton({label:"Manage Dependencies ...",onClick:this.openWidget,tooltip:"Manage Dependencies ..."});return e.toolbar.insertItem(11,"dependencyManagement",n),n}}const Q={dependencyManagement:"notebook:manage-dependencies"},Z={id:"jupyterlab_requirements",autoStart:!0,activate:async function(e){try{const t=new X;e.docRegistry.addWidgetExtension("Notebook",t),console.log("jupyterlab-requirements extension is activated!")}catch(e){console.error("Error on setting the jupyterlab-requirements extension")}return"ready"}}}}]);